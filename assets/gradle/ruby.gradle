buildscript {
	repositories {
        mavenLocal()
        mavenCentral()
    }
    
    apply from: "${sourceFile.parent}/common.gradle"
}

apply plugin: 'base'

// XXX TODO FIXME ... ? or use ruby direct !

def rubyTask(script, dst, src){
	task "rubyTask${dst}"(type: Exec, group: "gdx") {
	  	description = "Run ruby script"
	  	def inFile = new File("$projectDir/$src") // TODO src may be in $buildDir (typical) so don't use $projectDir reference
	  	def name = inFile.name.take(inFile.name.lastIndexOf('.'))
	  	def outFile = new File("$projectDir/$dst")
	  	def type = binary ? 'G3DB' : 'G3DJ'
	  	doFirst{
	  	    outFile.getParentFile().mkdirs()
	  	}
	  	// -f option to flip V texture coordinates from blender
		commandLine 'fbx-conv', '-f', '-o', type, '-v', "$inFile", "$outFile"
		outputs.upToDateWhen { outFile.exists() && inFile.lastModified() < outFile.lastModified() }
   	} 
}

ext {
    rubyTask = this.&rubyTask
}
